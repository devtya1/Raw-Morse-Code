<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Transmitter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f9;
        }

        #morseDisplay {
            font-size: 1.5em;
            margin-bottom: 20px;
            padding: 10px;
            border: 2px solid #333;
            width: 80%;
            text-align: center;
            word-wrap: break-word;
        }

        .button {
            width: 80px;
            height: 80px;
            background-color: #4CAF50;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-bottom: 20px;
        }

        #sendButton {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #008CBA;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="morseDisplay"></div>
    <button class="button" id="morseButton">Press</button>
    <button id="sendButton">Send</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBJP1UUNzEVahVanekcmoS6zCUunGjZh9Q",
            authDomain: "comms-7cb8c.firebaseapp.com",
            databaseURL: "https://comms-7cb8c-default-rtdb.firebaseio.com",
            projectId: "comms-7cb8c",
            storageBucket: "comms-7cb8c.firebasestorage.app",
            messagingSenderId: "113369441545",
            appId: "1:113369441545:web:8b472668adca3ac41adfd8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const morseButton = document.getElementById('morseButton');
        const sendButton = document.getElementById('sendButton');
        const morseDisplay = document.getElementById('morseDisplay');

        let morseCode = '';
        let message = '';
        let pressStartTime = 0;
        let lastPressTime = Date.now();

        // Morse Code Dictionary
        const morseDict = {
            '.-': 'A', '-...': 'B', '-.-.': 'C', '-..': 'D', '.': 'E', '..-.': 'F',
            '--.': 'G', '....': 'H', '..': 'I', '.---': 'J', '-.-': 'K', '.-..': 'L',
            '--': 'M', '-.': 'N', '---': 'O', '.--.': 'P', '--.-': 'Q', '.-.': 'R',
            '...': 'S', '-': 'T', '..-': 'U', '...-': 'V', '.--': 'W', '-..-': 'X',
            '-.--': 'Y', '--..': 'Z'
        };

        // Short press: "dit" | Long press: "dah"
        morseButton.addEventListener('mousedown', () => {
            pressStartTime = Date.now();
        });

        morseButton.addEventListener('mouseup', () => {
            const pressDuration = Date.now() - pressStartTime;
            if (pressDuration < 500) {
                morseCode += '.';
            } else {
                morseCode += '-';
            }

            updateDisplay();
            autoSpace();
        });

        // Update Morse code display
        function updateDisplay() {
            morseDisplay.textContent = morseCode;
        }

        // Auto spacing between letters
        function autoSpace() {
            const currentTime = Date.now();
            if (currentTime - lastPressTime > 1000 && morseCode) {
                const decodedLetter = morseDict[morseCode] || '';
                message += decodedLetter;
                message += ' '; // Add space after each letter
                morseCode = '';
                updateDisplay();
            }
            lastPressTime = currentTime;
        }

        // Send message to Firebase
        sendButton.addEventListener('click', () => {
            if (morseCode) {
                const decodedLetter = morseDict[morseCode] || '';
                message += decodedLetter;
            }

            // Save message to Firebase
            const timestamp = Date.now();
            database.ref('messages').push({
                message: message.trim(),
                timestamp: timestamp
            });

            morseDisplay.textContent = ''; // Clear display
            message = ''; // Reset message
            morseCode = ''; // Reset morse code
        });
    </script>
</body>
</html>
