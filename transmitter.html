<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Transmitter</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(to right, #283c86, #45a247);
            font-family: Arial, sans-serif;
            color: #fff;
        }
        h1 {
            text-shadow: 0 0 5px #45a247, 0 0 10px #283c86;
        }
        #morseDisplay {
            font-size: 2em;
            margin: 20px 0;
        }
        .button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #45a247;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #fff;
            border: none;
            outline: none;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        #sendButton {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #283c86;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1em;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>Morse Code Transmitter</h1>
    <div id="morseDisplay">_ _ _</div>
    <button class="button" id="morseButton">Press</button>
    <button id="sendButton">Send</button>

    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBJP1UUNzEVahVanekcmoS6zCUunGjZh9Q",
            authDomain: "comms-7cb8c.firebaseapp.com",
            databaseURL: "https://comms-7cb8c-default-rtdb.firebaseio.com",
            projectId: "comms-7cb8c",
            storageBucket: "comms-7cb8c.firebasestorage.app",
            messagingSenderId: "113369441545",
            appId: "1:113369441545:web:8b472668adca3ac41adfd8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const morseButton = document.getElementById('morseButton');
        const morseDisplay = document.getElementById('morseDisplay');
        let morseCode = '';
        let isDah = false; // Track whether the button press is "dit" or "dah"
        let lastPressTime = Date.now();
        
        morseButton.addEventListener('mousedown', () => {
            isDah = false; // Reset to dit on press start
            lastPressTime = Date.now();
        });

        morseButton.addEventListener('mouseup', () => {
            const pressDuration = Date.now() - lastPressTime;
            if (pressDuration > 300) {
                morseCode += '-';
            } else {
                morseCode += '.';
            }
            updateDisplay();
        });

        // Adds a space if thereâ€™s a delay of more than 1 second
        setInterval(() => {
            const now = Date.now();
            if (now - lastPressTime > 1000 && morseCode && morseCode.slice(-1) !== ' ') {
                morseCode += ' ';
                updateDisplay();
            }
        }, 200);

        // Update morse display in real-time
        function updateDisplay() {
            morseDisplay.textContent = morseCode;
        }

        document.getElementById('sendButton').addEventListener('click', () => {
            const message = convertMorseToText(morseCode.trim());
            db.ref('messages').push({
                message,
                timestamp: Date.now()
            });
            morseCode = ''; // Clear after sending
            updateDisplay();
        });

        function convertMorseToText(morse) {
            const morseDict = {
                '.-': 'A', '-...': 'B', '-.-.': 'C', '-..': 'D', '.': 'E',
                '..-.': 'F', '--.': 'G', '....': 'H', '..': 'I', '.---': 'J',
                '-.-': 'K', '.-..': 'L', '--': 'M', '-.': 'N', '---': 'O',
                '.--.': 'P', '--.-': 'Q', '.-.': 'R', '...': 'S', '-': 'T',
                '..-': 'U', '...-': 'V', '.--': 'W', '-..-': 'X', '-.--': 'Y',
                '--..': 'Z', '-----': '0', '.----': '1', '..---': '2',
                '...--': '3', '....-': '4', '.....': '5', '-....': '6',
                '--...': '7', '---..': '8', '----.': '9'
            };
            return morse.split(' ').map(code => morseDict[code] || '').join('');
        }
    </script>
</body>
</html>
